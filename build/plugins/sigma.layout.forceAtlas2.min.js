(function(undefined){"use strict";function Supervisor(sigInst,options){var _this=this,workerFn=sigInst.getForceAtlas2Worker();if(window.URL=window.URL||window.webkitURL,this.sigInst=sigInst,this.graph=this.sigInst.graph,this.ppn=10,this.ppe=3,this.config={},this.started=!1,this.running=!1,webWorkers){var blob=this.makeBlob(workerFn);this.worker=new Worker(URL.createObjectURL(blob)),this.worker.postMessage=this.worker.webkitPostMessage||this.worker.postMessage}else eval(workerFn);var msgName=this.worker?"message":"newCoords";(this.worker||document).addEventListener(msgName,function(t){t.data.converged&&(_this.running=!1),_this.nodesByteArray=new Float32Array(t.data.nodes),_this.running&&(_this.applyLayoutChanges(),_this.sendByteArrayToWorker(),_this.sigInst.refresh())}),this.graphToByteArrays()}if("undefined"==typeof sigma)throw"sigma is not declared";var webWorkers="Worker"in window;Supervisor.prototype.makeBlob=function(t){var e;try{e=new Blob([t],{type:"application/javascript"})}catch(r){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,e=new BlobBuilder,e.append(t),e=e.getBlob()}return e},Supervisor.prototype.graphToByteArrays=function(){var t,e,r,n=this.graph.nodes(),i=this.graph.edges(),o=n.length*this.ppn,s=i.length*this.ppe,a={};for(this.nodesByteArray=new Float32Array(o),this.edgesByteArray=new Float32Array(s),t=e=0,r=n.length;r>t;t++)a[n[t].id]=e,this.nodesByteArray[e]=n[t].x,this.nodesByteArray[e+1]=n[t].y,this.nodesByteArray[e+2]=0,this.nodesByteArray[e+3]=0,this.nodesByteArray[e+4]=0,this.nodesByteArray[e+5]=0,this.nodesByteArray[e+6]=1+this.graph.degree(n[t].id),this.nodesByteArray[e+7]=1,this.nodesByteArray[e+8]=n[t].size,this.nodesByteArray[e+9]=0,e+=this.ppn;for(t=e=0,r=i.length;r>t;t++)this.edgesByteArray[e]=a[i[t].source],this.edgesByteArray[e+1]=a[i[t].target],this.edgesByteArray[e+2]=i[t].weight||0,e+=this.ppe},Supervisor.prototype.applyLayoutChanges=function(){for(var t=this.graph.nodes(),e=0,r=0,n=this.nodesByteArray.length;n>r;r+=this.ppn)t[e].x=this.nodesByteArray[r],t[e].y=this.nodesByteArray[r+1],e++},Supervisor.prototype.sendByteArrayToWorker=function(t){var e={action:t||"loop",nodes:this.nodesByteArray.buffer},r=[this.nodesByteArray.buffer];"start"===t&&(e.config=this.config||{},e.edges=this.edgesByteArray.buffer,r.push(this.edgesByteArray.buffer)),webWorkers?this.worker.postMessage(e,r):window.postMessage(e,"*")},Supervisor.prototype.start=function(){if(!this.running){this.running=!0;var t,e;for(t in this.sigInst.cameras)e=this.sigInst.cameras[t],e.edgequadtree._enabled=!1;this.started?this.sendByteArrayToWorker():(this.sendByteArrayToWorker("start"),this.started=!0)}},Supervisor.prototype.stop=function(){if(this.running){var t,e,r;for(t in this.sigInst.cameras)e=this.sigInst.cameras[t],e.edgequadtree._enabled=!0,r=sigma.utils.getBoundaries(this.graph,e.readPrefix),e.settings("drawEdges")&&e.settings("enableEdgeHovering")&&e.edgequadtree.index(this.sigInst.graph,{prefix:e.readPrefix,bounds:{x:r.minX,y:r.minY,width:r.maxX-r.minX,height:r.maxY-r.minY}});this.running=!1}},Supervisor.prototype.killWorker=function(){this.worker.terminate()},Supervisor.prototype.configure=function(t){if(this.config=t,this.started){var e={action:"config",config:this.config};webWorkers?this.worker.postMessage(e):window.postMessage(e,"*")}};var supervisor=null;sigma.prototype.startForceAtlas2=function(t){return supervisor||(supervisor=new Supervisor(this)),t&&supervisor.configure(t),supervisor.start(),this},sigma.prototype.stopForceAtlas2=function(){return supervisor?(supervisor.stop(),this):this},sigma.prototype.killForceAtlas2=function(){return supervisor?(supervisor.stop(),supervisor.killWorker(),supervisor=null,this):this},sigma.prototype.configForceAtlas2=function(t){return supervisor||(supervisor=new Supervisor(this)),supervisor.configure(t),this},sigma.prototype.isForceAtlas2Running=function(){return supervisor&&supervisor.running}}).call(this),function(){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";var t=function(){function t(){var t,e,r={},n=arguments.length;for(t=n-1;t>=0;t--)for(e in arguments[t])r[e]=arguments[t][e];return r}function e(t,e,n){n=n||{};s.nodeMatrix=t,s.edgeMatrix=e,s.nodesLength=s.nodeMatrix.length,s.edgesLength=s.edgeMatrix.length,r(n)}function r(e){e.barnesHutOptimize=!1,s.settings=t(e,s.settings)}function n(){var t,e,r,n,i,o,a,d,g,h,M,p,u,x,c,f,y;for(r=0;r<s.nodesLength;r+=s.ppn)s.nodeMatrix[r+4]=s.nodeMatrix[r+2],s.nodeMatrix[r+5]=s.nodeMatrix[r+3],s.nodeMatrix[r+2]=0,s.nodeMatrix[r+3]=0;if(s.settings.outboundAttractionDistribution){for(g=0,r=0;r<s.nodesLength;r+=s.ppn)g+=s.nodeMatrix[r+6];g/=s.nodesLength}if(s.settings.barnesHutOptimize){var l,w,v=Math.pow(2,2*s.settings.barnesHutDepthLimit),b=Math.pow(2,s.settings.barnesHutDepthLimit),m=new UInt16Array(v),A=(new Float32Array(v*s.ppq),new UInt16Array(v)),B=(new UInt16Array(v),new UInt16Array(s.nodesLength)),k=(new UInt16Array(s.nodesLength),0),L=0,q=0,F=0;for(r=0;r<s.nodesLength;r+=s.ppn)k=Math.max(k,s.nodeMatrix[r]),q=Math.min(q,s.nodeMatrix[r]),L=Math.max(L,s.nodeMatrix[r+1]),F=Math.min(F,s.nodeMatrix[r+1]);for(k+=1e-4*(k-q),L+=1e-4*(L-F),r=0,e=0;r<s.nodesLength;r+=s.ppn,e++)l=(s.nodeMatrix[r]-q)/(k-q)*Math.pow(2,s.settings.barnesHutDepthLimit)|0,w=(s.nodeMatrix[r+1]-F)/(L-F)*Math.pow(2,s.settings.barnesHutDepthLimit)|0,m[l*b+w]+=1,B[e]=l*b+w;for(t=0,e=0;v>e;e++)t+=m[e],A[e]=t}if(s.settings.barnesHutOptimize);else for(n=0;n<s.nodesLength;n+=s.ppn)for(i=0;i<s.nodesLength;i+=s.ppn)M=s.nodeMatrix[n]-s.nodeMatrix[i],p=s.nodeMatrix[n+1]-s.nodeMatrix[i+1],s.settings.adjustSize?(f=Math.sqrt(M*M+p*p)-s.nodeMatrix[n+8]-s.nodeMatrix[i+8],f>0?(y=s.settings.scalingRatio*s.nodeMatrix[n+6]*s.nodeMatrix[i+6]/f/f,s.nodeMatrix[n+2]+=M*y,s.nodeMatrix[n+3]+=p*y,s.nodeMatrix[i+2]+=M*y,s.nodeMatrix[i+3]+=p*y):0>f&&(y=100*s.settings.scalingRatio*s.nodeMatrix[n+6]*s.nodeMatrix[i+6],s.nodeMatrix[n+2]+=M*y,s.nodeMatrix[n+3]+=p*y,s.nodeMatrix[i+2]-=M*y,s.nodeMatrix[i+3]-=p*y)):(f=Math.sqrt(M*M+p*p),f>0&&(y=s.settings.scalingRatio*s.nodeMatrix[n+6]*s.nodeMatrix[i+6]/f/f,s.nodeMatrix[n+2]+=M*y,s.nodeMatrix[n+3]+=p*y,s.nodeMatrix[i+2]-=M*y,s.nodeMatrix[i+3]-=p*y));for(d=s.settings.gravity/s.settings.scalingRatio,h=s.settings.scalingRatio,r=0;r<s.nodesLength;r+=s.ppn)y=0,M=s.nodeMatrix[r],p=s.nodeMatrix[r+1],f=Math.sqrt(Math.pow(M,2)+Math.pow(p,2)),s.settings.strongGravityMode?f>0&&(y=h*s.nodeMatrix[r+6]*d):f>0&&(y=h*s.nodeMatrix[r+6]*d/f),s.nodeMatrix[r+2]-=M*y,s.nodeMatrix[r+3]-=p*y;for(h=1*(s.settings.outboundAttractionDistribution?g:1),o=0;o<s.edgesLength;o+=s.ppe)n=s.edgeMatrix[o],i=s.edgeMatrix[o+1],a=s.edgeMatrix[o+2],c=0===s.settings.edgeWeightInfluence?1:1===s.settings.edgeWeightInfluence?a:Math.pow(a,s.settings.edgeWeightInfluence),M=s.nodeMatrix[n]-s.nodeMatrix[i],p=s.nodeMatrix[n+1]-s.nodeMatrix[i+1],s.settings.adjustSizes?(f=Math.sqrt(Math.pow(M,2)+Math.pow(p,2)-s.nodeMatrix[n+8]-s.nodeMatrix[i+8]),s.settings.linLogMode?s.settings.outboundAttractionDistribution?f>0&&(y=-h*c*Math.log(1+f)/f/s.nodeMatrix[n+6]):f>0&&(y=-h*c*Math.log(1+f)/f):s.settings.outboundAttractionDistribution?f>0&&(y=-h*c/s.nodeMatrix[n+6]):f>0&&(y=-h*c)):(f=Math.sqrt(Math.pow(M,2)+Math.pow(p,2)),s.settings.linLogMode?s.settings.outboundAttractionDistribution?f>0&&(y=-h*c*Math.log(1+f)/f/s.nodeMatrix[n+6]):f>0&&(y=-h*c*Math.log(1+f)/f):s.settings.outboundAttractionDistribution?(f=1,y=-h*c/s.nodeMatrix[n+6]):(f=1,y=-h*c)),f>0&&(s.nodeMatrix[n+2]+=M*y,s.nodeMatrix[n+3]+=p*y,s.nodeMatrix[i+2]-=M*y,s.nodeMatrix[i+3]-=p*y);var I,D,S,W,R=0;if(s.settings.adjustSizes)for(r=0;r<s.nodesLength;r+=s.ppn)s.nodeMatrix[r+9]||(I=Math.sqrt(Math.pow(s.nodeMatrix[r+2],2)+Math.pow(s.nodeMatrix[r+3],2)),I>s.maxForce&&(s.nodeMatrix[r+2]=s.nodeMatrix[r+2]*s.maxForce/I,s.nodeMatrix[r+3]=s.nodeMatrix[r+3]*s.maxForce/I),D=s.nodeMatrix[r+6]*Math.sqrt((s.nodeMatrix[r+4]-s.nodeMatrix[r+2])*(s.nodeMatrix[r+4]-s.nodeMatrix[r+2])+(s.nodeMatrix[r+5]-s.nodeMatrix[r+3])*(s.nodeMatrix[r+5]-s.nodeMatrix[r+3])),S=Math.sqrt((s.nodeMatrix[r+4]+s.nodeMatrix[r+2])*(s.nodeMatrix[r+4]+s.nodeMatrix[r+2])+(s.nodeMatrix[r+5]+s.nodeMatrix[r+3])*(s.nodeMatrix[r+5]+s.nodeMatrix[r+3]))/2,W=.1*Math.log(1+S)/(1+Math.sqrt(D)),u=s.nodeMatrix[r],x=s.nodeMatrix[r+1],s.nodeMatrix[r]=s.nodeMatrix[r]+s.nodeMatrix[r+2]*(W/s.settings.slowDown),s.nodeMatrix[r+1]=s.nodeMatrix[r+1]+s.nodeMatrix[r+3]*(W/s.settings.slowDown),M=s.nodeMatrix[r],p=s.nodeMatrix[r+1],f=Math.sqrt(Math.pow(M-u,2)+Math.pow(p-x,2)),R+=f);else for(r=0;r<s.nodesLength;r+=s.ppn)s.nodeMatrix[r+9]||(D=s.nodeMatrix[r+6]*Math.sqrt((s.nodeMatrix[r+4]-s.nodeMatrix[r+2])*(s.nodeMatrix[r+4]-s.nodeMatrix[r+2])+(s.nodeMatrix[r+5]-s.nodeMatrix[r+3])*(s.nodeMatrix[r+5]-s.nodeMatrix[r+3])),S=Math.sqrt((s.nodeMatrix[r+4]+s.nodeMatrix[r+2])*(s.nodeMatrix[r+4]+s.nodeMatrix[r+2])+(s.nodeMatrix[r+5]+s.nodeMatrix[r+3])*(s.nodeMatrix[r+5]+s.nodeMatrix[r+3]))/2,W=s.nodeMatrix[r+7]*Math.log(1+S)/(1+Math.sqrt(D)),s.nodeMatrix[r+7]=Math.min(1,Math.sqrt(W*(Math.pow(s.nodeMatrix[r+2],2)+Math.pow(s.nodeMatrix[r+3],2))/(1+Math.sqrt(D)))),u=s.nodeMatrix[r],x=s.nodeMatrix[r+1],s.nodeMatrix[r]=s.nodeMatrix[r]+s.nodeMatrix[r+2]*(W/s.settings.slowDown),s.nodeMatrix[r+1]=s.nodeMatrix[r+1]+s.nodeMatrix[r+3]*(W/s.settings.slowDown),M=s.nodeMatrix[r],p=s.nodeMatrix[r+1],f=Math.sqrt(Math.pow(M-u,2)+Math.pow(p-x,2)),R+=f);s.iterations++,s.settings.autoStop&&(s.converged=s.iterations>s.maxIterations||R/s.nodesLength<s.avgDistanceThreshold)}function i(){n(),o()}var o,s={ppn:10,ppe:3,ppq:2,maxForce:10,iterations:0,maxIterations:1e3,avgDistanceThreshold:.01,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:1,strongGravityMode:!1,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:1.2,barnesHutDepthLimit:4,autoStop:!1}};o="undefined"!=typeof window&&window.document?function(){var t=new Event("newCoords");t.data={nodes:s.nodeMatrix.buffer,converged:s.converged},requestAnimationFrame(function(){document.dispatchEvent(t)})}:function(){self.postMessage({nodes:s.nodeMatrix.buffer,converged:s.converged},[s.nodeMatrix.buffer])},self.addEventListener("message",function(t){switch(t.data.action){case"start":e(new Float32Array(t.data.nodes),new Float32Array(t.data.edges),t.data.config),i();break;case"loop":s.nodeMatrix=new Float32Array(t.data.nodes),i();break;case"config":r(t.data.config)}})},e=null;sigma.prototype.getForceAtlas2Worker=function(){var r=e?e(t.toString()):t.toString();return";("+r+").call(this);"}}.call(this);