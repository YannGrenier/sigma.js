(function(){"use strict";function a(a){var b=window.getComputedStyle(a),c=function(a){return parseInt(b.getPropertyValue(a).replace("px",""))||0};return{left:a.getBoundingClientRect().left+c("padding-left"),top:a.getBoundingClientRect().top+c("padding-top")}}function b(a){q[a.data.node.id]||(p.push(a.data.node),q[a.data.node.id]=!0,p.length&&!r&&(n=p[p.length-1],l.addEventListener("mousedown",d)))}function c(a){var b=p.map(function(a){return a}).indexOf(a.data.node);p.splice(b,1),delete q[a.data.node.id],p.length&&!r?n=p[p.length-1]:l.removeEventListener("mousedown",d)}function d(a){r=!0;var b=i.graph.nodes().length;if(b>0){l.removeEventListener("mousedown",d),j.addEventListener("mousemove",f),j.addEventListener("mouseup",e);var c,g;for(c in i.cameras)g=i.cameras[c],void 0!==g.edgequadtree&&(g.edgequadtree._enabled=!1);k.settings({mouseEnabled:!1,enableHovering:!1}),i.refresh(),h.dispatchEvent("startdrag",{node:n,captor:a,renderer:k})}}function e(a){r=!1,l.addEventListener("mousedown",d),j.removeEventListener("mousemove",f),j.removeEventListener("mouseup",e);var b,c;for(b in i.cameras)c=i.cameras[b],void 0!==c.edgequadtree&&(c.edgequadtree._enabled=!0);k.settings({mouseEnabled:!0,enableHovering:!0}),i.refresh(),t&&h.dispatchEvent("drop",{node:n,captor:a,renderer:k}),h.dispatchEvent("dragend",{node:n,captor:a,renderer:k}),t=!1}function f(b){function c(){for(var c=a(k.container),d=b.pageX-c.left,e=b.pageY-c.top,f=Math.cos(m.angle),g=Math.sin(m.angle),j=i.graph.nodes(),l=[],p=0;2>p;p++){var q=j[p],r={x:q.x*f+q.y*g,y:q.y*f-q.x*g,renX:q[o+"x"],renY:q[o+"y"]};l.push(r)}d=(d-l[0].renX)/(l[1].renX-l[0].renX)*(l[1].x-l[0].x)+l[0].x,e=(e-l[0].renY)/(l[1].renY-l[0].renY)*(l[1].y-l[0].y)+l[0].y,n.x=d*f-e*g,n.y=e*f+d*g,i.refresh(),t=!0,h.dispatchEvent("drag",{node:n,captor:b,renderer:k})}if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){clearTimeout(d);var d=setTimeout(c,0)}else c()}function g(a,d){if(sigma.classes.dispatcher.extend(this),sigma.renderers.webgl&&d instanceof sigma.renderers.webgl)throw new Error("The sigma.plugins.dragNodes is not compatible with the WebGL renderer");h=this,i=a,j=document.body,k=d,l=d.container.lastChild,m=d.camera,n=null,o="",p=[],q={},r=!1,s=!1,t=!1,o=d instanceof sigma.renderers.webgl?d.options.prefix.substr(5):d.options.prefix,d.bind("overNode",b),d.bind("outNode",c)}if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.plugins");var h,i,j,k,l,m,n,o,p,q,r,s,t,u=null;sigma.plugins.dragNodes=function(a,b){return u||(u=new g(a,b)),u},sigma.plugins.killDragNodes=function(){u instanceof g&&(l.removeEventListener("mousedown",d),j.removeEventListener("mousemove",f),j.removeEventListener("mouseup",e),k.unbind("overNode",b),k.unbind("outNode",c),u=null)}}).call(window);