(function(){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.plugins"),sigma.plugins.dragNodes=function(a,b){if(sigma.classes.dispatcher.extend(this),sigma.renderers.webgl&&b instanceof sigma.renderers.webgl)throw new Error("The sigma.plugins.dragNodes is not compatible with the WebGL renderer");var c=this,d=document.body,e=b.container,f=e.lastChild,g=b.camera,h=null,i="",j=[],k={},l=!1,m=!1;i=b instanceof sigma.renderers.webgl?b.options.prefix.substr(5):b.options.prefix;var n=function(a){var b=window.getComputedStyle(a),c=function(a){return parseInt(b.getPropertyValue(a).replace("px",""))||0};return{left:a.getBoundingClientRect().left+c("padding-left"),top:a.getBoundingClientRect().top+c("padding-top")}},o=function(a){k[a.data.node.id]||(j.push(a.data.node),k[a.data.node.id]=!0,j.length&&!l&&(h=j[j.length-1],f.addEventListener("mousedown",q)))},p=function(a){var b=j.map(function(a){return a}).indexOf(a.data.node);j.splice(b,1),delete k[a.data.node.id],j.length&&!l?h=j[j.length-1]:f.removeEventListener("mousedown",q)},q=function(e){l=!0;var g=a.graph.nodes().length;if(g>1){f.removeEventListener("mousedown",q),d.addEventListener("mousemove",s),d.addEventListener("mouseup",r);var i,j;for(i in a.cameras)j=a.cameras[i],j.edgequadtree._enabled=!1;b.settings({mouseEnabled:!1,enableHovering:!1}),a.refresh(),c.dispatchEvent("startdrag",{node:h,captor:e,renderer:b})}},r=function(e){l=!1,f.addEventListener("mousedown",q),d.removeEventListener("mousemove",s),d.removeEventListener("mouseup",r);var g,i;for(g in a.cameras)i=a.cameras[g],i.edgequadtree._enabled=!0;b.settings({mouseEnabled:!0,enableHovering:!0}),a.refresh(),m&&c.dispatchEvent("drop",{node:h,captor:e,renderer:b}),c.dispatchEvent("dragend",{node:h,captor:e,renderer:b}),m=!1},s=function(d){function f(){for(var f=n(e),j=d.pageX-f.left,k=d.pageY-f.top,l=Math.cos(g.angle),o=Math.sin(g.angle),p=a.graph.nodes(),q=[],r=0;2>r;r++){var s=p[r],t={x:s.x*l+s.y*o,y:s.y*l-s.x*o,renX:s[i+"x"],renY:s[i+"y"]};q.push(t)}j=(j-q[0].renX)/(q[1].renX-q[0].renX)*(q[1].x-q[0].x)+q[0].x,k=(k-q[0].renY)/(q[1].renY-q[0].renY)*(q[1].y-q[0].y)+q[0].y,h.x=j*l-k*o,h.y=k*l+j*o,a.refresh(),m=!0,c.dispatchEvent("drag",{node:h,captor:d,renderer:b})}if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){clearTimeout(j);var j=setTimeout(f,0)}else f()};return b.bind("overNode",o),b.bind("outNode",p),this}}).call(window);