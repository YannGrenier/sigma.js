(function(){"use strict";function a(a){var b=window.getComputedStyle(a),c=function(a){return parseInt(b.getPropertyValue(a).replace("px",""))||0};return{left:a.getBoundingClientRect().left+c("padding-left"),top:a.getBoundingClientRect().top+c("padding-top")}}function b(a){p[a.data.node.id]||(o.push(a.data.node),p[a.data.node.id]=!0,o.length&&!q&&(m=o[o.length-1],k.addEventListener("mousedown",d)))}function c(a){var b=o.map(function(a){return a}).indexOf(a.data.node);o.splice(b,1),delete p[a.data.node.id],o.length&&!q?m=o[o.length-1]:k.removeEventListener("mousedown",d)}function d(a){q=!0;var b=s.graph.nodes().length;if(b>0){k.removeEventListener("mousedown",d),i.addEventListener("mousemove",f),i.addEventListener("mouseup",e);var c,g;for(c in s.cameras)g=s.cameras[c],void 0!==g.edgequadtree&&(g.edgequadtree._enabled=!1);j.settings({mouseEnabled:!1,enableHovering:!1}),s.refresh(),h.dispatchEvent("startdrag",{node:m,captor:a,renderer:j})}}function e(a){q=!1,k.addEventListener("mousedown",d),i.removeEventListener("mousemove",f),i.removeEventListener("mouseup",e);var b,c;for(b in s.cameras)c=s.cameras[b],void 0!==c.edgequadtree&&(c.edgequadtree._enabled=!0);j.settings({mouseEnabled:!0,enableHovering:!0}),s.refresh(),t&&h.dispatchEvent("drop",{node:m,captor:a,renderer:j}),h.dispatchEvent("dragend",{node:m,captor:a,renderer:j}),t=!1}function f(b){function c(){for(var c=a(j.container),d=b.pageX-c.left,e=b.pageY-c.top,f=Math.cos(l.angle),g=Math.sin(l.angle),i=s.graph.nodes(),k=[],o=0;2>o;o++){var p=i[o],q={x:p.x*f+p.y*g,y:p.y*f-p.x*g,renX:p[n+"x"],renY:p[n+"y"]};k.push(q)}d=(d-k[0].renX)/(k[1].renX-k[0].renX)*(k[1].x-k[0].x)+k[0].x,e=(e-k[0].renY)/(k[1].renY-k[0].renY)*(k[1].y-k[0].y)+k[0].y,m.x=d*f-e*g,m.y=e*f+d*g,s.refresh(),t=!0,h.dispatchEvent("drag",{node:m,captor:b,renderer:j})}if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){clearTimeout(d);var d=setTimeout(c,0)}else c()}function g(a,d){if(sigma.classes.dispatcher.extend(this),sigma.renderers.webgl&&d instanceof sigma.renderers.webgl)throw new Error("The sigma.plugins.dragNodes is not compatible with the WebGL renderer");h=this,i=document.body,j=d,k=d.container.lastChild,l=d.camera,m=null,n="",o=[],p={},q=!1,r=!1,t=!1,n=d instanceof sigma.renderers.webgl?d.options.prefix.substr(5):d.options.prefix,d.bind("overNode",b),d.bind("outNode",c)}if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.plugins");var h,i,j,k,l,m,n,o,p,q,r,t,u=null;sigma.plugins.dragNodes=function(a,b){return u||(u=new g(a,b)),u},sigma.plugins.killDragNodes=function(){k.removeEventListener("mousedown",d),i.removeEventListener("mousemove",f),i.removeEventListener("mouseup",e),j.unbind("overNode",b),j.unbind("outNode",c),u=null}}).call(window);